<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ぽこっとわーるど！ 魔物地計算機</title>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --accent-phys: #e57373; /* 物理: 赤系 */
            --accent-mag: #64b5f6;  /* 魔法: 青系 */
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --btn-hover: #f0f0f0;
        }

        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        h1 {
            text-align: center;
            font-size: 1.4rem;
            margin: 10px 0 20px;
            color: var(--text-main);
            letter-spacing: 0.05em;
        }

        /* 共通カードスタイル */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 24px;
            transition: transform 0.2s ease;
        }

        /* ステータス入力エリア */
        .input-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .input-item {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.85rem;
            color: var(--text-sub);
            margin-bottom: 6px;
            font-weight: bold;
        }

        input[type="number"] {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
            width: 100%;
            box-sizing: border-box;
            background: #f9f9f9;
            transition: all 0.2s;
            text-align: center;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #888;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.05);
        }

        /* 結果表示エリア */
        .result-display {
            margin-top: 24px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            text-align: center;
            border-top: 1px dashed #eee;
            padding-top: 24px;
        }

        .result-box h3 {
            margin: 0 0 8px 0;
            font-size: 0.95rem;
            color: var(--text-sub);
        }

        .result-box .level-badge {
            font-size: 2rem;
            font-weight: 800;
            line-height: 1.2;
        }

        .phys-color { color: var(--accent-phys); }
        .mag-color { color: var(--accent-mag); }

        /* シミュレーターエリア */
        .sim-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .circle-btn {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text-main);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .circle-btn:hover {
            background-color: var(--btn-hover);
            transform: translateY(-2px);
        }

        .sim-title {
            font-size: 1.3rem;
            font-weight: bold;
            min-width: 160px;
            text-align: center;
        }

        .sim-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .sim-panel {
            background: #fafafa;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #eee;
            position: relative;
            overflow: hidden;
        }

        .sim-panel.phys { border-top: 4px solid var(--accent-phys); }
        .sim-panel.mag { border-top: 4px solid var(--accent-mag); }

        .mob-info {
            text-align: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }

        .mob-name {
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .mob-stats {
            font-size: 0.9rem;
            color: var(--text-sub);
            font-family: monospace; /* 数字を揃えるため */
        }

        /* 攻撃回数コントロール */
        .attack-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .mini-btn {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mini-btn:hover { background: #f0f0f0; }

        .attack-input-wrapper {
            position: relative;
            width: 70px;
        }
        .attack-input-wrapper input {
            padding-right: 24px; /* "回"の文字分 */
        }
        .unit-label {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            color: #999;
            pointer-events: none;
        }

        /* フォーム行 */
        .form-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .form-row:last-child { margin-bottom: 0; }

        .form-row label {
            margin: 0;
            width: 50px;
            font-size: 0.9rem;
        }

        .form-row input {
            width: calc(100% - 60px);
            padding: 10px;
            font-size: 1rem;
        }
        
        .readonly-input {
            background-color: #e9ecef !important;
            color: #495057;
            font-weight: bold;
            border-color: #ced4da;
        }

        @media (max-width: 600px) {
            .input-group { grid-template-columns: 1fr; }
            .sim-grid { grid-template-columns: 1fr; }
            .result-display { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ぽこっとわーるど！ 計算機</h1>

    <!-- 現在のステータス入力 -->
    <div class="card">
        <div class="input-group">
            <div class="input-item">
                <label>現在のHP</label>
                <input type="number" id="myHp" placeholder="0">
            </div>
            <div class="input-item">
                <label>筋力</label>
                <input type="number" id="myStr" placeholder="0">
            </div>
            <div class="input-item">
                <label>知力</label>
                <input type="number" id="myInt" placeholder="0">
            </div>
        </div>

        <div class="result-display">
            <div class="result-box">
                <h3>到達可能 (物理)</h3>
                <div class="level-badge phys-color" id="resPhys">計算中...</div>
            </div>
            <div class="result-box">
                <h3>到達可能 (魔法)</h3>
                <div class="level-badge mag-color" id="resMag">計算中...</div>
            </div>
        </div>
    </div>

    <!-- シミュレーター -->
    <div class="card">
        <div class="sim-header">
            <button class="circle-btn" onclick="changeSimLevel(-25)">◀</button>
            <div class="sim-title">怪奇の魔物地 <br><span id="simLevelDisplay" style="font-size:1.6rem;">25</span>級</div>
            <button class="circle-btn" onclick="changeSimLevel(25)">▶</button>
        </div>

        <div class="sim-grid">
            <!-- 物理シミュレーター -->
            <div class="sim-panel phys">
                <div class="mob-info">
                    <div class="mob-name phys-color">【物理】魔物</div>
                    <div class="mob-stats" id="mobPhysStats">HP:?? / ATK:??</div>
                </div>

                <div class="attack-control">
                    <button class="mini-btn" onclick="adjustCount('phys', -1)">◀</button>
                    <div class="attack-input-wrapper">
                        <input type="number" id="simPhysCount" value="1" min="1" onchange="calcByCount('phys')">
                        <span class="unit-label">回</span>
                    </div>
                    <button class="mini-btn" onclick="adjustCount('phys', 1)">▶</button>
                </div>

                <div class="form-row">
                    <label>HP</label>
                    <input type="number" id="simPhysHp" oninput="calcByHp('phys')">
                </div>
                <div class="form-row">
                    <label>筋力</label>
                    <input type="number" id="simPhysReq" class="readonly-input" readonly>
                </div>
            </div>

            <!-- 魔法シミュレーター -->
            <div class="sim-panel mag">
                <div class="mob-info">
                    <div class="mob-name mag-color">【魔法】魔物</div>
                    <div class="mob-stats" id="mobMagStats">HP:?? / ATK:??</div>
                </div>

                <div class="attack-control">
                    <button class="mini-btn" onclick="adjustCount('mag', -1)">◀</button>
                    <div class="attack-input-wrapper">
                        <input type="number" id="simMagCount" value="1" min="1" onchange="calcByCount('mag')">
                        <span class="unit-label">回</span>
                    </div>
                    <button class="mini-btn" onclick="adjustCount('mag', 1)">▶</button>
                </div>

                <div class="form-row">
                    <label>HP</label>
                    <input type="number" id="simMagHp" oninput="calcByHp('mag')">
                </div>
                <div class="form-row">
                    <label>知力</label>
                    <input type="number" id="simMagReq" class="readonly-input" readonly>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 初期設定・定数 ---
    const STORAGE_KEY = 'poco_world_calc_v2';
    
    // デフォルト値
    const DEFAULTS = {
        hp: 50,
        str: 5,
        int: 5,
        simLevel: 25
    };

    // DOM要素の取得
    const els = {
        myHp: document.getElementById('myHp'),
        myStr: document.getElementById('myStr'),
        myInt: document.getElementById('myInt'),
        resPhys: document.getElementById('resPhys'),
        resMag: document.getElementById('resMag'),

        simLevel: document.getElementById('simLevelDisplay'),
        
        // 物理側
        mobPhysStats: document.getElementById('mobPhysStats'),
        simPhysCount: document.getElementById('simPhysCount'),
        simPhysHp: document.getElementById('simPhysHp'),
        simPhysReq: document.getElementById('simPhysReq'),

        // 魔法側
        mobMagStats: document.getElementById('mobMagStats'),
        simMagCount: document.getElementById('simMagCount'),
        simMagHp: document.getElementById('simMagHp'),
        simMagReq: document.getElementById('simMagReq'),
    };

    let state = { ...DEFAULTS };

    // --- 計算ロジック ---

    // 魔物のステータス計算
    // 体力:(等級+1)×50, 攻撃力:(等級+1)×5
    function getMobStats(level) {
        return {
            hp: (level + 1) * 50,
            atk: (level + 1) * 5
        };
    }

    // 到達可能レベルの計算
    function updateReachability() {
        const hp = parseInt(els.myHp.value) || 0;
        const str = parseInt(els.myStr.value) || 0;
        const int = parseInt(els.myInt.value) || 0;

        els.resPhys.textContent = calcMaxLevel(hp, str) + "級";
        els.resMag.textContent = calcMaxLevel(hp, int) + "級";
        
        saveData();
    }

    // 指定ステータスで勝てる最高レベルを返す
    function calcMaxLevel(hp, atkStat) {
        if (hp <= 0 || atkStat <= 0) return "不可";
        
        // 単純ループで計算（ある程度高いレベルまでチェック）
        // ※効率化のため、計算上限を設けています
        for (let lvl = 0; lvl <= 5000; lvl++) {
            const mob = getMobStats(lvl);
            
            // プレイヤーが耐えられる被弾回数
            // HP > MobAtk * hits となる最大のhits
            // hits = floor((HP - 1) / MobAtk)
            // 攻撃可能回数 = hits + 1 (先制攻撃のため)
            let attacks = 1;
            if (hp > mob.atk) {
                attacks += Math.floor((hp - 1) / mob.atk);
            }
            
            // 与ダメージ
            const dmg = attacks * atkStat;
            
            // 倒せなかったら、前のレベルが限界
            if (dmg < mob.hp) {
                return lvl > 0 ? (lvl - 1) : "不可";
            }
        }
        return "5000+";
    }

    // --- シミュレーターロジック ---

    function updateSimulatorUI() {
        els.simLevel.textContent = state.simLevel;
        const mob = getMobStats(state.simLevel);
        const text = `HP:${mob.hp} / ATK:${mob.atk}`;
        els.mobPhysStats.textContent = text;
        els.mobMagStats.textContent = text;

        // レベルが変わったら現在の攻撃回数設定に基づいて再計算
        calcByCount('phys');
        calcByCount('mag');
        
        saveData();
    }

    // 攻撃回数をもとに、必要なHPと攻撃力を計算する (Count -> HP, ReqStat)
    function calcByCount(type) {
        const mob = getMobStats(state.simLevel);
        const countInput = type === 'phys' ? els.simPhysCount : els.simMagCount;
        const hpInput = type === 'phys' ? els.simPhysHp : els.simMagHp;
        const reqInput = type === 'phys' ? els.simPhysReq : els.simMagReq;

        let count = parseInt(countInput.value);
        if (count < 1) count = 1;
        countInput.value = count;

        // 必要HP計算
        // N回攻撃する = (N-1)回被弾に耐える必要がある
        // 耐えるHP = (MobAtk * (N-1)) + 1
        const hitsToSurvive = count - 1;
        const reqHp = (mob.atk * hitsToSurvive) + 1;
        
        // 必要火力計算
        // N回でMobHPを削り切る
        // ReqStat = ceil(MobHP / N)
        const reqStat = Math.ceil(mob.hp / count);

        hpInput.value = reqHp;
        reqInput.value = reqStat;
    }

    // 入力されたHPをもとに、攻撃回数と必要な攻撃力を計算する (HP -> Count, ReqStat)
    function calcByHp(type) {
        const mob = getMobStats(state.simLevel);
        const countInput = type === 'phys' ? els.simPhysCount : els.simMagCount;
        const hpInput = type === 'phys' ? els.simPhysHp : els.simMagHp;
        const reqInput = type === 'phys' ? els.simPhysReq : els.simMagReq;

        const hp = parseInt(hpInput.value) || 1;
        
        // 攻撃回数計算
        // 耐えられる回数 = floor((HP - 1) / MobAtk)
        // 攻撃できる回数 = 耐えられる回数 + 1
        let attacks = 1;
        if (hp > mob.atk) {
            attacks += Math.floor((hp - 1) / mob.atk);
        }

        // 必要火力計算
        const reqStat = Math.ceil(mob.hp / attacks);

        countInput.value = attacks;
        reqInput.value = reqStat;
    }

    // --- 操作系 ---

    window.changeSimLevel = (delta) => {
        let newLvl = state.simLevel + delta;
        if (newLvl < 25) newLvl = 0;
        state.simLevel = newLvl;
        updateSimulatorUI();
    };

    window.adjustCount = (type, delta) => {
        const el = type === 'phys' ? els.simPhysCount : els.simMagCount;
        let val = parseInt(el.value) || 1;
        val += delta;
        if (val < 1) val = 1;
        el.value = val;
        calcByCount(type);
    };

    // --- データ保存・読み込み ---

    function saveData() {
        const data = {
            hp: parseInt(els.myHp.value) || 0,
            str: parseInt(els.myStr.value) || 0,
            int: parseInt(els.myInt.value) || 0,
            simLevel: state.simLevel
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function loadData() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                state = { ...state, ...parsed };
            } catch(e) {
                console.error("Save data error", e);
            }
        }
        // UIに反映
        els.myHp.value = state.hp;
        els.myStr.value = state.str;
        els.myInt.value = state.int;
        updateReachability();
        updateSimulatorUI();
    }

    // イベントリスナー設定
    [els.myHp, els.myStr, els.myInt].forEach(el => {
        el.addEventListener('input', updateReachability);
    });

    // 初期化
    loadData();

</script>

</body>
</html>
